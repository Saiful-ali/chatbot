<!-- ========================================
     public/admin.html - Admin Dashboard
     ======================================== -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
  <div class="max-w-4xl mx-auto">
    <header class="bg-blue-600 text-white rounded-lg p-6 mb-6">
      <h1 class="text-3xl font-bold">ğŸ§‘â€ğŸ’¼ Admin Dashboard</h1>
      <p>Broadcast health updates to WhatsApp subscribers</p>
    </header>

    <section class="bg-white rounded-lg shadow-md p-6 mb-6">
      <h2 class="text-2xl font-semibold mb-4">ğŸ“¢ Add New Update</h2>
      <form id="updateForm" class="space-y-4">
        <input type="text" id="title" placeholder="Title" class="w-full px-4 py-2 border rounded" required>
        <textarea id="description" placeholder="Description" class="w-full px-4 py-2 border rounded h-32" required></textarea>
        <select id="priority" class="w-full px-4 py-2 border rounded">
          <option value="low">Low</option>
          <option value="medium" selected>Medium</option>
          <option value="high">High</option>
          <option value="critical">Critical</option>
        </select>
        <button type="submit" class="bg-green-600 text-white px-6 py-3 rounded hover:bg-green-700">Send to All Subscribers</button>
      </form>
      <p id="status" class="mt-4"></p>
    </section>

    <section class="bg-white rounded-lg shadow-md p-6">
      <h2 class="text-2xl font-semibold mb-4">ğŸ“‹ Recent Updates</h2>
      <ul id="updatesList" class="space-y-2"></ul>
    </section>
  </div>

  <script>
    const SERVER = "http://localhost:5000";
    let ADMIN_KEY = localStorage.getItem("ADMIN_KEY") || prompt("ğŸ” Enter admin password:");
    if (!ADMIN_KEY) location.reload();
    localStorage.setItem("ADMIN_KEY", ADMIN_KEY);

    const form = document.getElementById("updateForm");
    const statusEl = document.getElementById("status");
    const listEl = document.getElementById("updatesList");

    async function loadUpdates() {
      const res = await fetch(`${SERVER}/api/admin/updates`, {
        headers: { "x-admin-key": ADMIN_KEY },
      });

      if (res.status === 403) {
        alert("âŒ Unauthorized");
        localStorage.removeItem("ADMIN_KEY");
        location.reload();
        return;
      }

      const data = await res.json();
      listEl.innerHTML = data.map((u) => `<li class="p-3 border-b"><strong>${u.title}</strong><p class="text-sm text-gray-600">${u.description}</p></li>`).join("");
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const newUpdate = {
        title: document.getElementById("title").value,
        description: document.getElementById("description").value,
        priority: document.getElementById("priority").value,
      };

      const res = await fetch(`${SERVER}/api/admin/add-update`, {
        method: "POST",
        headers: { "Content-Type": "application/json", "x-admin-key": ADMIN_KEY },
        body: JSON.stringify(newUpdate),
      });

      const data = await res.json();
      if (data.success) {
        statusEl.textContent = `âœ… Sent to ${data.stats.success} subscribers`;
        statusEl.className = "text-green-700";
        form.reset();
        loadUpdates();
      } else {
        statusEl.textContent = "âŒ Failed";
        statusEl.className = "text-red-700";
      }
    });

    loadUpdates();
  </script>
</body>
</html>

<!-- See whatsapp-qr.html in previous artifact -->